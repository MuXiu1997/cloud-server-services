name: Sync Docker Secret

on:
  workflow_dispatch: { }

jobs:
  sync-docker-secret:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup node
        uses: actions/setup-node@v2
        with:
          node-version: '14'
      - name: Setup zx
        run: npm i -g zx@4.2.0
      - name: Set ssh rivate key
        run: |
          mkdir -p ~/.ssh
          chmod 700 ~/.ssh
          echo '${{ secrets.SSH_PRIVATE_KEY }}' > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
      - name: Sync docker secret
        run: >-
          zx ./.github/.scripts/sync-docker-secret.mjs
          --sshHost=${{ secrets.SSH_HOST }}
          --sshUsername=${{ secrets.SSH_USERNAME }}
        env:
          DOCKER_SECRET_TRAEFIL_ALICLOUD_ACCESS_KEY: ${{ secrets.TRAEFIL_ALICLOUD_ACCESS_KEY }}
          DOCKER_SECRET_TRAEFIL_ALICLOUD_REGION_ID: ${{ secrets.TRAEFIL_ALICLOUD_REGION_ID }}
          DOCKER_SECRET_TRAEFIL_ALICLOUD_SECRET_KEY: ${{ secrets.TRAEFIL_ALICLOUD_SECRET_KEY }}
          DOCKER_SECRET_BITWARDEN_SMTP_USERNAME: ${{ secrets.BITWARDEN_SMTP_USERNAME }}
          DOCKER_SECRET_BITWARDEN_SMTP_PASSWORD: ${{ secrets.BITWARDEN_SMTP_PASSWORD }}
          DOCKER_SECRET_BITWARDEN_ADMIN_TOKEN: ${{ secrets.BITWARDEN_ADMIN_TOKEN }}

